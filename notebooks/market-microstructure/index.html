<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Market Microstructure - Advanced Analytics and Algorithmic Trading</title><meta property="og:title" content="Market Microstructure - Advanced Analytics and Algorithmic Trading"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><meta name="image" content="/build/cover-09caa9dd03fd74a2e96de11fa5332265.jpg"/><meta property="og:image" content="/build/cover-09caa9dd03fd74a2e96de11fa5332265.jpg"/><link rel="stylesheet" href="/build/_assets/app-AIT5GAEP.css"/><link rel="stylesheet" href="/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100vw;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"><div class="myst-action-menu relative" data-headlessui-state=""><div><button class="myst-action-menu-button flex text-sm bg-transparent rounded-full focus:outline-none" id="headlessui-menu-button-:Rr5cp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open Menu</span><div class="flex items-center text-stone-200 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="p-1"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" clip-rule="evenodd"></path></svg></div></button></div></div></div><div class="hidden sm:block"><a href="https://www.datasciencealgotrading.com" target="_blank" rel="noopener noreferrer" class="inline-block px-4 py-2 mx-1 mt-0 leading-none border rounded text-md border-stone-700 dark:border-white text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 hover:bg-neutral-100">Advanced Analytics and Algorithmic Trading</a></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="Advanced Analytics and Algorithmic Trading" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/">Advanced Analytics and Algorithmic Trading</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Introduction" class="block break-words rounded py-2 grow cursor-pointer">Introduction</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Financial Markets Fundamentals" class="block break-words rounded py-2 grow cursor-pointer">Financial Markets Fundamentals</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Financial Modelling Fundamentals" class="block break-words rounded py-2 grow cursor-pointer">Financial Modelling Fundamentals</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Execution Algorithms" class="block break-words rounded py-2 grow cursor-pointer">Execution Algorithms</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Market Making Algorithms" class="block break-words rounded py-2 grow cursor-pointer">Market Making Algorithms</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Investment Algorithms" class="block break-words rounded py-2 grow cursor-pointer">Investment Algorithms</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1upsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1upsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Glossary and References" class="block break-words rounded py-2 grow cursor-pointer">Glossary and References</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R26psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R26psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="open" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Notebooks" class="block break-words rounded py-2 grow font-semibold text-blue-800 dark:text-blue-200 cursor-pointer">Notebooks</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R2epsp:" aria-expanded="true" data-state="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="open" id="radix-:R2epsp:" class="pl-3 pr-[2px] collapsible-content"><a title="Stochastic Calculus" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/notebooks/stochastic-calculus">Stochastic Calculus</a><a title="Bayesian Modelling" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/notebooks/bayesian-theory">Bayesian Modelling</a><a title="Market Microstructure" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg myst-toc-item-exact bg-blue-300/30 active" href="/notebooks/market-microstructure">Market Microstructure</a><a title="Modelling RfQs in Dealer to Client Markets" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/notebooks/rfq-models">Modelling RfQs in Dealer to Client Markets</a><a title="Fair Price Estimation" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/notebooks/fair-price-estimation">Fair Price Estimation</a></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/https://xaviweise.github.io/aaat/" title="GitHub Repository: https://xaviweise.github.io/aaat/" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://xaviweise.github.io/aaat//edit/main/notebooks/market_microstructure.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Market Microstructure</h1><header class="myst-fm-authors-affiliations mt-4 not-prose"><div class="myst-fm-authors-list"><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78ucp:" data-state="closed"><span class="myst-fm-author-name">Javier Sabio González</span></button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="QBhnTYvcKk" class="myst-jp-nb-block relative group/block"><h2 id="the-central-limit-order-book" class="relative group"><span class="heading-text">The Central Limit Order Book</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#the-central-limit-order-book" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><h3 id="visualization-of-the-order-book" class="relative group"><span class="heading-text">Visualization of the order book</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#visualization-of-the-order-book" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="QQNv1VVk8F" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import matplotlib.pyplot as plt
import numpy as np

# Define bid and ask prices
bid_prices = np.array([94, 95, 96, 97, 98, 99])  # Bid price levels
ask_prices = np.array([101, 102, 103, 104, 105, 106])  # Ask price levels

# Randomize volumes for bids and asks
np.random.seed(45)  # For reproducibility
bid_volumes = np.random.randint(50, 400, size=len(bid_prices))  # Random volumes for bids
ask_volumes = np.random.randint(50, 400, size=len(ask_prices))  # Random volumes for asks

# Empty volumes for levels close to the mid-price (bid at 99 and ask at 101)
bid_volumes[5] = 0  # Bid close to mid (price 99)
ask_volumes[0] = 0  # Ask close to mid (price 101)

# Calculate the best bid and ask prices and their volumes
# Best bid: highest bid price with non-zero volume
nonzero_bid_indices = np.where(bid_volumes &gt; 0)[0]
if len(nonzero_bid_indices) &gt; 0:
    best_bid_price = bid_prices[nonzero_bid_indices].max()
    best_bid_index = np.where(bid_prices == best_bid_price)[0][0]
    best_bid_volume = bid_volumes[best_bid_index]
else:
    best_bid_price = None
    best_bid_volume = 0

# Best ask: lowest ask price with non-zero volume
nonzero_ask_indices = np.where(ask_volumes &gt; 0)[0]
if len(nonzero_ask_indices) &gt; 0:
    best_ask_price = ask_prices[nonzero_ask_indices].min()
    best_ask_index = np.where(ask_prices == best_ask_price)[0][0]
    best_ask_volume = ask_volumes[best_ask_index]
else:
    best_ask_price = None
    best_ask_volume = 0

# Calculate mid-price and spread
if best_bid_price is not None and best_ask_price is not None:
    mid_price = (best_bid_price + best_ask_price) / 2
    spread = best_ask_price - best_bid_price
else:
    mid_price = None
    spread = None

# Calculate imbalance between best bid and ask volumes
total_volume = best_bid_volume + best_ask_volume
if total_volume &gt; 0:
    imbalance = (best_bid_volume - best_ask_volume) / total_volume
else:
    imbalance = None

# Create figure and axes
fig, ax = plt.subplots(figsize=(10, 6))

# Plot bid bars (leave a gap near the mid-price)
ax.bar(bid_prices, bid_volumes, color=&#x27;green&#x27;, align=&#x27;center&#x27;, label=&#x27;Bid Orders&#x27;)

# Plot ask bars (leave a gap near the mid-price)
ax.bar(ask_prices, ask_volumes, color=&#x27;red&#x27;, align=&#x27;center&#x27;, label=&#x27;Ask Orders&#x27;)

# Mid-price line
if mid_price is not None:
    ax.axvline(mid_price, color=&#x27;black&#x27;, linestyle=&#x27;--&#x27;, label=f&#x27;Mid Price&#x27;)
else:
    ax.axvline(100, color=&#x27;black&#x27;, linestyle=&#x27;--&#x27;, label=&#x27;Mid Price&#x27;)

# Adding x-axis ticks for every integer price level from min to max price
all_price_levels = np.arange(min(bid_prices.min(), ask_prices.min()), max(bid_prices.max(), ask_prices.max()) + 1)
ax.set_xticks(all_price_levels)
ax.set_xticklabels(all_price_levels)

# Labels and title
ax.set_ylabel(&#x27;Volume&#x27;)
ax.set_xlabel(&#x27;Price Levels&#x27;)
ax.set_title(&#x27;Central Limit Order Book (Market Depth)&#x27;)
ax.legend()

# Show the plot
plt.show()

# Print the calculated values
print(&quot;Calculated Market Metrics:&quot;)
if best_bid_price is not None:
    print(f&quot;Best Bid Price: {best_bid_price}, Volume: {best_bid_volume}&quot;)
else:
    print(&quot;No bids available.&quot;)

if best_ask_price is not None:
    print(f&quot;Best Ask Price: {best_ask_price}, Volume: {best_ask_volume}&quot;)
else:
    print(&quot;No asks available.&quot;)

if mid_price is not None and spread is not None:
    print(f&quot;Mid-Price: {mid_price:.2f}&quot;)
    print(f&quot;Spread: {spread:.2f}&quot;)
else:
    print(&quot;Mid-Price and Spread are not available.&quot;)

if imbalance is not None:
    print(f&quot;Imbalance between best bid and ask: {imbalance:.2f}&quot;)
else:
    print(&quot;Imbalance is not available due to zero total volume at best bid and ask.&quot;)
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="IWxTIOTHePRBICEBkL1lZ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/build/b3c608131bbf816449255a1770f121c6.png" alt="&lt;Figure size 1000x600 with 1 Axes&gt;"/></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Calculated Market Metrics:
Best Bid Price: 98, Volume: 213
Best Ask Price: 102, Volume: 65
Mid-Price: 100.00
Spread: 4.00
Imbalance between best bid and ask: 0.53
</span></code></pre></div></div></div></div><div id="WHnzyKkXzv" class="myst-jp-nb-block relative group/block"><h3 id="effect-of-a-market-order-in-the-clob" class="relative group"><span class="heading-text">Effect of a market order in the CLOB</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#effect-of-a-market-order-in-the-clob" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="Z7X9zCNiD5" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import matplotlib.pyplot as plt
import numpy as np

# Define bid and ask prices
bid_prices = np.array([94, 95, 96, 97, 98, 99])  # Bid price levels
ask_prices = np.array([101, 102, 103, 104, 105, 106])  # Ask price levels

# Randomize volumes for bids and asks
np.random.seed(45)  # For reproducibility
bid_volumes = np.random.randint(50, 400, size=len(bid_prices))  # Random volumes for bids
ask_volumes = np.random.randint(50, 400, size=len(ask_prices))  # Random volumes for asks

# Empty volumes for levels close to the mid-price (bid at 99 and ask at 101)
bid_volumes[5] = 0  # Bid close to mid
ask_volumes[0] = 0  # Ask close to mid

# Arrays to track consumed volumes (for visualization)
consumed_bid_volumes = np.zeros(len(bid_volumes))
consumed_ask_volumes = np.zeros(len(ask_volumes))

mid_price = 100  # Initial mid-price before market order execution

# Simulate market order input
market_order_size = 500  # For example, 500
market_order_side = &quot;buy&quot;  # For example, &#x27;buy&#x27;

# Function to simulate the market order
def execute_market_order(order_size, order_side):
    global bid_volumes, ask_volumes, consumed_bid_volumes, consumed_ask_volumes
    executed_volume = 0
    executed_value = 0

    if order_side == &#x27;buy&#x27;:  # Market order to buy shares
        remaining_size = order_size
        for i in range(len(ask_prices)):
            if ask_volumes[i] &gt; 0:
                tradable_volume = min(ask_volumes[i], remaining_size)
                executed_volume += tradable_volume
                executed_value += tradable_volume * ask_prices[i]
                consumed_ask_volumes[i] += tradable_volume  # Track consumed volume
                ask_volumes[i] -= tradable_volume
                remaining_size -= tradable_volume
                if remaining_size &lt;= 0:
                    break
    elif order_side == &#x27;sell&#x27;:  # Market order to sell shares
        remaining_size = order_size
        for i in range(len(bid_prices)-1, -1, -1):  # Start from highest bid
            if bid_volumes[i] &gt; 0:
                tradable_volume = min(bid_volumes[i], remaining_size)
                executed_volume += tradable_volume
                executed_value += tradable_volume * bid_prices[i]
                consumed_bid_volumes[i] += tradable_volume  # Track consumed volume
                bid_volumes[i] -= tradable_volume
                remaining_size -= tradable_volume
                if remaining_size &lt;= 0:
                    break

    # Calculate the average execution price
    execution_price = executed_value / executed_volume if executed_volume &gt; 0 else 0
    return execution_price

# Function to recalculate the mid-price based on the updated order book
def recalculate_mid_price():
    global bid_prices, bid_volumes, ask_prices, ask_volumes
    # Get the best bid price (highest bid price with non-zero volume)
    if np.any(bid_volumes &gt; 0):
        best_bid = np.max(bid_prices[bid_volumes &gt; 0])
    else:
        best_bid = np.nan  # No bids in the book

    # Get the best ask price (lowest ask price with non-zero volume)
    if np.any(ask_volumes &gt; 0):
        best_ask = np.min(ask_prices[ask_volumes &gt; 0])
    else:
        best_ask = np.nan  # No asks in the book

    # Recalculate mid-price
    if not np.isnan(best_bid) and not np.isnan(best_ask):
        new_mid_price = (best_bid + best_ask) / 2
    elif not np.isnan(best_bid):
        new_mid_price = best_bid  # Only bids are available
    elif not np.isnan(best_ask):
        new_mid_price = best_ask  # Only asks are available
    else:
        new_mid_price = np.nan  # No bids or asks in the book

    return new_mid_price

# Updated function to visualize the order book
def plot_order_book(order_side, mid_price):
    fig, ax = plt.subplots(figsize=(10, 6))

    # Plot remaining bid orders in green
    ax.bar(bid_prices, bid_volumes, color=&#x27;green&#x27;, align=&#x27;center&#x27;, label=&#x27;Remaining Bid Orders&#x27;)

    # Plot remaining ask orders in red
    ax.bar(ask_prices, ask_volumes, color=&#x27;red&#x27;, align=&#x27;center&#x27;, label=&#x27;Remaining Ask Orders&#x27;)

    # Plot consumed liquidity based on the order side
    if order_side == &#x27;buy&#x27;:
        # Plot consumed ask liquidity on top with a hatch pattern
        if np.any(consumed_ask_volumes &gt; 0):
            ax.bar(ask_prices, consumed_ask_volumes, bottom=ask_volumes, color=&#x27;red&#x27;, align=&#x27;center&#x27;,
                   label=&#x27;Consumed Ask Liquidity&#x27;, hatch=&#x27;\\\\&#x27;, edgecolor=&#x27;red&#x27;, alpha=0.7)
    elif order_side == &#x27;sell&#x27;:
        # Plot consumed bid liquidity on top with a hatch pattern
        if np.any(consumed_bid_volumes &gt; 0):
            ax.bar(bid_prices, consumed_bid_volumes, bottom=bid_volumes, color=&#x27;green&#x27;, align=&#x27;center&#x27;,
                   label=&#x27;Consumed Bid Liquidity&#x27;, hatch=&#x27;//&#x27;, edgecolor=&#x27;green&#x27;, alpha=0.7)

    # Mid-price line
    if not np.isnan(mid_price):
        ax.axvline(mid_price, color=&#x27;black&#x27;, linestyle=&#x27;--&#x27;, label=f&#x27;Mid Price&#x27;)
    else:
        ax.axvline(mid_price, color=&#x27;black&#x27;, linestyle=&#x27;--&#x27;, label=&#x27;Mid Price Unavailable&#x27;)

    # Adding x-axis ticks for every integer price level from min to max price
    all_price_levels = np.arange(min(bid_prices.min(), ask_prices.min()), max(bid_prices.max(), ask_prices.max()) + 1)
    ax.set_xticks(all_price_levels)
    ax.set_xticklabels(all_price_levels)

    # Labels and title
    ax.set_ylabel(&#x27;Volume&#x27;)
    ax.set_xlabel(&#x27;Price Levels&#x27;)
    ax.set_title(&#x27;Effect of a Market Order in the CLOB&#x27;)

    # Custom legend to include only relevant labels
    handles, labels = ax.get_legend_handles_labels()
    by_label = dict(zip(labels, handles))

    # Filter the legend labels based on the order side
    if order_side == &#x27;buy&#x27;:
        by_label.pop(&#x27;Consumed Bid Liquidity&#x27;, None)
    elif order_side == &#x27;sell&#x27;:
        by_label.pop(&#x27;Consumed Ask Liquidity&#x27;, None)

    ax.legend(by_label.values(), by_label.keys())

    plt.show()

# Execute the market order and update the order book
execution_price = execute_market_order(market_order_size, market_order_side)

# Recalculate the mid-price based on the updated order book
new_mid_price = recalculate_mid_price()

# Plot the updated order book with the new mid-price
plot_order_book(market_order_side, new_mid_price)

# Output the execution price and the new mid-price
print(f&quot;The average execution price for the market order is: {execution_price:.2f}&quot;)
if not np.isnan(new_mid_price):
    print(f&quot;The new mid-price after the market order execution is: {new_mid_price:.2f}&quot;)
else:
    print(&quot;The mid-price is unavailable due to no bids or asks in the book.&quot;)
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="UZosG2jm3LR3gxiYpJ20S" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/build/aa56161046499d81cae58ec2da0f4e3f.png" alt="&lt;Figure size 1000x600 with 1 Axes&gt;"/></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>The average execution price for the market order is: 103.51
The new mid-price after the market order execution is: 101.00
</span></code></pre></div></div></div></div><div id="fSuqGcsPVt" class="myst-jp-nb-block relative group/block"><h3 id="effect-of-a-limit-order-in-the-clob" class="relative group"><span class="heading-text">Effect of a limit order in the CLOB</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#effect-of-a-limit-order-in-the-clob" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="xWYYlIV16n" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import matplotlib.pyplot as plt
import numpy as np

# Define bid and ask prices
bid_prices = np.array([94, 95, 96, 97, 98, 99])  # Bid price levels
ask_prices = np.array([101, 102, 103, 104, 105, 106])  # Ask price levels

# Randomize volumes for bids and asks
np.random.seed(45)  # For reproducibility
bid_volumes = np.random.randint(50, 400, size=len(bid_prices))  # Random volumes for bids
ask_volumes = np.random.randint(50, 400, size=len(ask_prices))  # Random volumes for asks

# Empty volumes for levels close to the mid-price (bid at 99 and ask at 101)
bid_volumes[5] = 0  # Bid close to mid
ask_volumes[0] = 0  # Ask close to mid

# Arrays to track consumed volumes and new limit orders for visualization
consumed_bid_volumes = np.zeros(len(bid_volumes))
consumed_ask_volumes = np.zeros(len(ask_volumes))
new_bid_volumes = np.zeros(len(bid_volumes))
new_ask_volumes = np.zeros(len(ask_volumes))

mid_price = 100  # Initial mid-price before limit order execution

# Function to simulate an aggressive limit order
def execute_limit_order(order_price, order_volume, order_side):
    global bid_volumes, ask_volumes, consumed_bid_volumes, consumed_ask_volumes, new_bid_volumes, new_ask_volumes

    executed_volume = 0
    executed_value = 0
    remaining_volume = order_volume

    if order_side == &#x27;buy&#x27;:
        best_ask = min(ask_prices[ask_volumes &gt; 0]) if np.any(ask_volumes &gt; 0) else np.inf
        if order_price &lt; best_ask:
            # The buy limit order remains unexecuted and gets added to the book below existing orders
            insert_order_into_book(order_price, remaining_volume, &#x27;buy&#x27;, priority=&#x27;low&#x27;)
            return 0, remaining_volume  # No execution, entire order sits in the book
        else:
            # The buy limit order consumes liquidity like a market order up to the limit price
            for i in range(len(ask_prices)):
                if ask_prices[i] &lt;= order_price and ask_volumes[i] &gt; 0:
                    if ask_volumes[i] &gt;= remaining_volume:
                        executed_volume += remaining_volume
                        executed_value += remaining_volume * ask_prices[i]
                        consumed_ask_volumes[i] += remaining_volume  # Track consumed volume
                        ask_volumes[i] -= remaining_volume
                        remaining_volume = 0
                        break
                    else:
                        executed_volume += ask_volumes[i]
                        executed_value += ask_volumes[i] * ask_prices[i]
                        consumed_ask_volumes[i] += ask_volumes[i]  # Track consumed volume
                        remaining_volume -= ask_volumes[i]
                        ask_volumes[i] = 0
            # Any remaining volume sits in the book at the limit price
            if remaining_volume &gt; 0:
                insert_order_into_book(order_price, remaining_volume, &#x27;buy&#x27;, priority=&#x27;low&#x27;)

    elif order_side == &#x27;sell&#x27;:
        best_bid = max(bid_prices[bid_volumes &gt; 0]) if np.any(bid_volumes &gt; 0) else -np.inf
        if order_price &gt; best_bid:
            # The sell limit order remains unexecuted and gets added to the book above existing orders
            insert_order_into_book(order_price, remaining_volume, &#x27;sell&#x27;, priority=&#x27;low&#x27;)
            return 0, remaining_volume  # No execution, entire order sits in the book
        else:
            # The sell limit order consumes liquidity like a market order up to the limit price
            for i in range(len(bid_prices)-1, -1, -1):  # Start from highest bid
                if bid_prices[i] &gt;= order_price and bid_volumes[i] &gt; 0:
                    if bid_volumes[i] &gt;= remaining_volume:
                        executed_volume += remaining_volume
                        executed_value += remaining_volume * bid_prices[i]
                        consumed_bid_volumes[i] += remaining_volume  # Track consumed volume
                        bid_volumes[i] -= remaining_volume
                        remaining_volume = 0
                        break
                    else:
                        executed_volume += bid_volumes[i]
                        executed_value += bid_volumes[i] * bid_prices[i]
                        consumed_bid_volumes[i] += bid_volumes[i]  # Track consumed volume
                        remaining_volume -= bid_volumes[i]
                        bid_volumes[i] = 0
            # Any remaining volume sits in the book at the limit price
            if remaining_volume &gt; 0:
                insert_order_into_book(order_price, remaining_volume, &#x27;sell&#x27;, priority=&#x27;low&#x27;)

    # Calculate the average execution price
    execution_price = executed_value / executed_volume if executed_volume &gt; 0 else 0
    return execution_price, remaining_volume

# Function to insert the remaining limit order into the order book
def insert_order_into_book(order_price, remaining_volume, order_side, priority):
    global bid_prices, ask_prices, bid_volumes, ask_volumes, new_bid_volumes, new_ask_volumes, consumed_bid_volumes, consumed_ask_volumes

    if order_side == &#x27;buy&#x27;:  # Remaining buy order stays as a bid
        # Check if the price level exists
        if order_price in bid_prices:
            index = np.where(bid_prices == order_price)[0][0]
            if priority == &#x27;low&#x27;:
                new_bid_volumes[index] += remaining_volume  # Lower priority new limit order
            else:
                bid_volumes[index] += remaining_volume  # Higher priority remaining volume
        else:
            # Insert a new price level
            bid_prices = np.append(bid_prices, order_price)
            bid_volumes = np.append(bid_volumes, 0 if priority == &#x27;low&#x27; else remaining_volume)
            new_bid_volumes = np.append(new_bid_volumes, remaining_volume if priority == &#x27;low&#x27; else 0)
            consumed_bid_volumes = np.append(consumed_bid_volumes, 0)
            # Sort by price
            sort_indices = np.argsort(bid_prices)
            bid_prices = bid_prices[sort_indices]
            bid_volumes = bid_volumes[sort_indices]
            new_bid_volumes = new_bid_volumes[sort_indices]
            consumed_bid_volumes = consumed_bid_volumes[sort_indices]

    elif order_side == &#x27;sell&#x27;:  # Remaining sell order stays as an ask
        # Check if the price level exists
        if order_price in ask_prices:
            index = np.where(ask_prices == order_price)[0][0]
            if priority == &#x27;low&#x27;:
                new_ask_volumes[index] += remaining_volume  # Lower priority new limit order
            else:
                ask_volumes[index] += remaining_volume  # Higher priority remaining volume
        else:
            # Insert a new price level
            ask_prices = np.append(ask_prices, order_price)
            ask_volumes = np.append(ask_volumes, 0 if priority == &#x27;low&#x27; else remaining_volume)
            new_ask_volumes = np.append(new_ask_volumes, remaining_volume if priority == &#x27;low&#x27; else 0)
            consumed_ask_volumes = np.append(consumed_ask_volumes, 0)
            # Sort by price
            sort_indices = np.argsort(ask_prices)
            ask_prices = ask_prices[sort_indices]
            ask_volumes = ask_volumes[sort_indices]
            new_ask_volumes = new_ask_volumes[sort_indices]
            consumed_ask_volumes = consumed_ask_volumes[sort_indices]

# Function to recalculate the mid-price based on the updated order book
def recalculate_mid_price():
    global bid_prices, bid_volumes, ask_prices, ask_volumes, new_bid_volumes, new_ask_volumes
    # Calculate total bid volumes at each price level
    total_bid_volumes = bid_volumes + new_bid_volumes
    # Get the best bid price (highest bid price with non-zero volume)
    if np.any(total_bid_volumes &gt; 0):
        best_bid = np.max(bid_prices[total_bid_volumes &gt; 0])
    else:
        best_bid = np.nan  # No bids in the book

    # Calculate total ask volumes at each price level
    total_ask_volumes = ask_volumes + new_ask_volumes
    # Get the best ask price (lowest ask price with non-zero volume)
    if np.any(total_ask_volumes &gt; 0):
        best_ask = np.min(ask_prices[total_ask_volumes &gt; 0])
    else:
        best_ask = np.nan  # No asks in the book

    # Recalculate mid-price
    if not np.isnan(best_bid) and not np.isnan(best_ask):
        new_mid_price = (best_bid + best_ask) / 2
    elif not np.isnan(best_bid):
        new_mid_price = best_bid  # Only bids are available
    elif not np.isnan(best_ask):
        new_mid_price = best_ask  # Only asks are available
    else:
        new_mid_price = np.nan  # No bids or asks in the book

    return new_mid_price

# Updated function to visualize the order book
def plot_order_book(order_side, mid_price):
    fig, ax = plt.subplots(figsize=(10, 6))

    # For bids
    # Total volumes for stacking
    bid_total_volumes = new_bid_volumes + bid_volumes + consumed_bid_volumes

    # Plot new bid limit orders at the bottom
    ax.bar(bid_prices, new_bid_volumes, color=&#x27;darkgreen&#x27;, align=&#x27;center&#x27;,
           label=&#x27;New Bid Limit Orders&#x27;)

    # Plot existing bid orders on top of new limit orders
    bid_existing_bottom = new_bid_volumes
    ax.bar(bid_prices, bid_volumes, bottom=bid_existing_bottom, color=&#x27;green&#x27;, align=&#x27;center&#x27;,
           label=&#x27;Remaining Bid Orders&#x27;)

    # Plot consumed bid liquidity on top of existing orders
    bid_consumed_bottom = bid_existing_bottom + bid_volumes
    if np.any(consumed_bid_volumes &gt; 0):
        ax.bar(bid_prices, consumed_bid_volumes, bottom=bid_consumed_bottom, color=&#x27;green&#x27;, align=&#x27;center&#x27;,
               label=&#x27;Consumed Liquidity&#x27;, hatch=&#x27;//&#x27;, edgecolor=&#x27;green&#x27;, alpha=0.7)

    # For asks
    # Total volumes for stacking
    ask_total_volumes = new_ask_volumes + ask_volumes + consumed_ask_volumes

    # Plot new ask limit orders at the bottom
    ax.bar(ask_prices, new_ask_volumes, color=&#x27;darkred&#x27;, align=&#x27;center&#x27;,
           label=&#x27;New Ask Limit Orders&#x27;)

    # Plot existing ask orders on top of new limit orders
    ask_existing_bottom = new_ask_volumes
    ax.bar(ask_prices, ask_volumes, bottom=ask_existing_bottom, color=&#x27;red&#x27;, align=&#x27;center&#x27;,
           label=&#x27;Remaining Ask Orders&#x27;)

    # Plot consumed ask liquidity on top of existing orders
    ask_consumed_bottom = ask_existing_bottom + ask_volumes
    if np.any(consumed_ask_volumes &gt; 0):
        ax.bar(ask_prices, consumed_ask_volumes, bottom=ask_consumed_bottom, color=&#x27;red&#x27;, align=&#x27;center&#x27;,
               label=&#x27;Consumed Liquidity&#x27;, hatch=&#x27;\\\\&#x27;, edgecolor=&#x27;red&#x27;, alpha=0.7)

    # Mid-price line
    if not np.isnan(mid_price):
        ax.axvline(mid_price, color=&#x27;black&#x27;, linestyle=&#x27;--&#x27;, label=f&#x27;Mid Price&#x27;)
    else:
        ax.axvline(mid_price, color=&#x27;black&#x27;, linestyle=&#x27;--&#x27;, label=&#x27;Mid Price Unavailable&#x27;)

    # Adding x-axis ticks
    all_price_levels = np.arange(min(bid_prices.min(), ask_prices.min()), max(bid_prices.max(), ask_prices.max()) + 1)
    ax.set_xticks(all_price_levels)
    ax.set_xticklabels(all_price_levels)

    # Labels and title
    ax.set_ylabel(&#x27;Volume&#x27;)
    ax.set_xlabel(&#x27;Price Levels&#x27;)
    ax.set_title(&#x27;Effect of a limit order in the CLOB&#x27;)

    # Custom legend
    handles, labels = ax.get_legend_handles_labels()
    by_label = dict(zip(labels, handles))
    ax.legend(by_label.values(), by_label.keys())

    plt.show()

# Example of a buy limit order at price 102 for 700 shares
limit_order_price = 98
limit_order_volume = 500
limit_order_side = &#x27;buy&#x27;

# Execute the limit order
execution_price, remaining_volume = execute_limit_order(limit_order_price, limit_order_volume, limit_order_side)

# Recalculate the mid-price based on the updated order book
new_mid_price = recalculate_mid_price()

# Plot the updated order book with the new mid-price
plot_order_book(limit_order_side, new_mid_price)

# Output the execution price and remaining order details
print(f&quot;The average execution price for the limit order is: {execution_price:.2f}&quot;)
if remaining_volume &gt; 0:
    print(f&quot;Remaining order of {remaining_volume} shares sits in the book at the limit price of {limit_order_price}.&quot;)
if not np.isnan(new_mid_price):
    print(f&quot;The new mid-price after the limit order execution is: {new_mid_price:.2f}&quot;)
else:
    print(&quot;The mid-price is unavailable due to no bids or asks in the book.&quot;)
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="OMJhGqBioJAC682T-k69h" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-image"><img src="/build/35c62b7c186dc7d9deaf54963ae515ee.png" alt="&lt;Figure size 1000x600 with 1 Axes&gt;"/></div><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>The average execution price for the limit order is: 0.00
Remaining order of 500 shares sits in the book at the limit price of 98.
The new mid-price after the limit order execution is: 100.00
</span></code></pre></div></div></div></div><div id="XHdrIHcUfd" class="myst-jp-nb-block relative group/block"><h2 id="the-rfq-process-in-md2c-platforms" class="relative group"><span class="heading-text">The RfQ process in MD2C platforms</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#the-rfq-process-in-md2c-platforms" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><h3 id="visualization-of-rfq-process" class="relative group"><span class="heading-text">Visualization of RfQ process</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#visualization-of-rfq-process" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="IUlsbn4cL2" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from graphviz import Digraph

# Create a new directed graph
dot = Digraph(comment=&#x27;RfQ Protocol&#x27;)

# Graph-level attributes for font
dot.attr(fontname=&#x27;Helvetica&#x27;, fontsize=&#x27;12&#x27;)

# Add nodes with custom fonts
dot.node(&#x27;Client&#x27;, &#x27;Client&#x27;, shape=&#x27;ellipse&#x27;, style=&#x27;filled&#x27;, color=&#x27;lightblue&#x27;, fontname=&#x27;Helvetica&#x27;, fontsize=&#x27;12&#x27;)
dot.node(&#x27;Platform&#x27;, &#x27;Platform&#x27;, shape=&#x27;box&#x27;, style=&#x27;filled&#x27;, color=&#x27;lightgrey&#x27;, fontname=&#x27;Helvetica&#x27;, fontsize=&#x27;12&#x27;)

# Add dealers with custom fonts
for i in range(1, 5):  # Adjust the number of dealers as needed
    dot.node(f&#x27;Dealer{i}&#x27;, f&#x27;Dealer {i}&#x27;, shape=&#x27;ellipse&#x27;, style=&#x27;filled&#x27;, color=&#x27;lightcoral&#x27;, fontname=&#x27;Helvetica-Italic&#x27;, fontsize=&#x27;12&#x27;)

# Add edges with custom fonts
dot.edge(&#x27;Client&#x27;, &#x27;Platform&#x27;, label=&#x27;RfQ&#x27;, fontname=&#x27;Courier&#x27;, fontsize=&#x27;10&#x27;, fontcolor=&#x27;darkblue&#x27;)
for i in range(1, 5):
    dot.edge(&#x27;Platform&#x27;, f&#x27;Dealer{i}&#x27;, label=f&#x27;RfQ&#x27;, fontname=&#x27;Courier&#x27;, fontsize=&#x27;10&#x27;, fontcolor=&#x27;darkblue&#x27;)
    dot.edge(f&#x27;Dealer{i}&#x27;, &#x27;Platform&#x27;, label=f&#x27;Quote{i}&#x27;, fontname=&#x27;Courier&#x27;, fontsize=&#x27;10&#x27;, fontcolor=&#x27;darkred&#x27;)
dot.edge(&#x27;Platform&#x27;, &#x27;Client&#x27;, label=&#x27;Quotes&#x27;, fontname=&#x27;Courier&#x27;, fontsize=&#x27;10&#x27;, fontcolor=&#x27;darkred&#x27;)

# Render and display the graph
# dot.render(&quot;/Users/javier/Documents/aaat/markdown/rfq&quot;, format=&#x27;png&#x27;, cleanup=True)
dot</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="Mgwz7arTdpFPlbuIc8NkG" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="jBd2Ko8kG6" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"></code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="2fxPxkhBaPKkNnAzjRbeb" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/notebooks/bayesian-theory"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Notebooks</div>Bayesian Modelling</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/notebooks/rfq-models"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Notebooks</div>Modelling RfQs in Dealer to Client Markets</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/build/_shared/chunk-OYMW4E3D.js"/><link rel="modulepreload" href="/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/build/root-CXYA7X5D.js"/><link rel="modulepreload" href="/build/_shared/chunk-DATP5P2X.js"/><link rel="modulepreload" href="/build/routes/$-JRBPULBO.js"/><script>window.__remixContext = {"url":"/notebooks/market-microstructure","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.7.0","options":{"folders":true},"nav":[],"actions":[{"title":"Advanced Analytics and Algorithmic Trading","url":"https://www.datasciencealgotrading.com","internal":false,"static":false}],"projects":[{"bibliography":["/Users/javier/Documents/aaat/references.bib"],"exports":[],"title":"Advanced Analytics and Algorithmic Trading","authors":[{"nameParsed":{"literal":"Javier Sabio González","given":"Javier Sabio","family":"González"},"name":"Javier Sabio González","id":"contributors-myst-generated-uid-0"}],"github":"https://xaviweise.github.io/aaat/","toc":[{"file":"welcome.md"},{"children":[{"file":"markdown/releases.md"},{"file":"markdown/dedication.md"},{"file":"markdown/preface.md"},{"file":"markdown/symbollist.md"}],"title":"Introduction"},{"children":[{"file":"markdown/intro_financial_markets.md"},{"file":"markdown/intro_financial_instruments.md"},{"file":"markdown/market_microstructure.md"},{"file":"markdown/algorithmic_trading.md"}],"title":"Financial Markets Fundamentals"},{"children":[{"file":"markdown/intro_bayesian.md"},{"file":"markdown/intro_causal.md"},{"file":"markdown/stochastic_calculus.md"},{"file":"markdown/stochastic_optimal_control.md"},{"file":"markdown/data_driven_methods.md"},{"file":"markdown/generative_ai.md"}],"title":"Financial Modelling Fundamentals"},{"children":[{"file":"markdown/execution_fundamentals.md"},{"file":"markdown/lob_models.md"},{"file":"markdown/almgren_chriss.md"},{"file":"markdown/execution_tactics.md"}],"title":"Execution Algorithms"},{"children":[{"file":"markdown/market_making_fundamentals.md"},{"file":"markdown/fair_price_estimation.md"},{"file":"markdown/liquidity_modelling.md"},{"file":"markdown/rfq_models.md"},{"file":"markdown/avellaneda_stoikov.md"},{"file":"markdown/enriching_avellaneda.md"},{"file":"markdown/hedging.md"},{"file":"markdown/market_making_rl.md"}],"title":"Market Making Algorithms"},{"children":[{"file":"markdown/quant_investment_fundamentals.md"},{"file":"markdown/mean_reversion_strategies.md"},{"file":"markdown/trend_following.md"},{"file":"markdown/arbitrage.md"},{"file":"markdown/factor_investing.md"},{"file":"markdown/optimal_portfolios.md"}],"title":"Investment Algorithms"},{"children":[{"file":"markdown/glossary.md"},{"file":"markdown/references.md"}],"title":"Glossary and References"},{"children":[{"file":"notebooks/stochastic_calculus.ipynb"},{"file":"notebooks/bayesian_theory.ipynb"},{"file":"notebooks/market_microstructure.ipynb"},{"file":"notebooks/rfq_models.ipynb"},{"file":"notebooks/fair_price_estimation.ipynb"}],"title":"Notebooks"}],"thumbnail":"/build/cover-09caa9dd03fd74a2e96de11fa5332265.jpg","index":"index","pages":[{"level":1,"title":"Introduction"},{"slug":"markdown.releases","title":"Release Notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.dedication","title":"Dedication","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.preface","title":"Preface","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.symbollist","title":"Symbols","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Financial Markets Fundamentals"},{"slug":"markdown.intro-financial-markets","title":"Financial Markets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.intro-financial-instruments","title":"Mechanics of Financial Instruments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.market-microstructure","title":"Market microstructure","description":"","date":"","thumbnail":"/build/market_depth_clob-8d7158d59689e10c78a15c00090f3dc4.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.algorithmic-trading","title":"Algorithmic Trading","description":"","date":"","thumbnail":"/build/limit_vs_market-0a6d7ce61f57effed138b6bb69160517.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Financial Modelling Fundamentals"},{"slug":"markdown.intro-bayesian","title":"Bayesian Modelling","description":"","date":"","thumbnail":"/build/BernoulliUniformPrio-612a838836d4fde1c1b34df2b9eb9c9d.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.intro-causal","title":"Causal inference","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.stochastic-calculus","title":"Stochastic Calculus","description":"","date":"","thumbnail":"/build/num_inflation_target-584cfec49aaf388290dcb09ab4055202.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.stochastic-optimal-control","title":"Stochastic optimal control","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.data-driven-methods","title":"Data-driven methods","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.generative-ai","title":"Generative Artificial Intelligence","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Execution Algorithms"},{"slug":"markdown.execution-fundamentals","title":"Execution fundamentals","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.lob-models","title":"Modelling the Limit Order Book","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.almgren-chriss","title":"The Almgren - Chriss Framework","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.execution-tactics","title":"Execution tactics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Market Making Algorithms"},{"slug":"markdown.market-making-fundamentals","title":"Market Making fundamentals","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.fair-price-estimation","title":"Fair value estimation","description":"","date":"","thumbnail":"/build/kalman_correlated-8857bc936e112d039ba99093affb1fea.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.liquidity-modelling","title":"Liquidity modelling","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.rfq-models","title":"Modelling RfQs in Dealer to Client Markets","description":"","date":"","thumbnail":"/build/pgm_rfq-e1698d70d99c736157fd61e8c19c7918.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.avellaneda-stoikov","title":"The Avellaneda and Stoikov Framework","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.enriching-avellaneda","title":"Enriching the Avellaneda and Stoikov Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.hedging","title":"Hedging strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.market-making-rl","title":"Reinforcement Learning and Market Making","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Investment Algorithms"},{"slug":"markdown.quant-investment-fundamentals","title":"Quantitative investment fundamentals","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.mean-reversion-strategies","title":"Mean reversion strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.trend-following","title":"Trend following strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.arbitrage","title":"Arbitrage Strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.factor-investing","title":"Factor Investing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.optimal-portfolios","title":"Optimal portfolios","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Glossary and References"},{"slug":"markdown.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.references","title":"References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Notebooks"},{"slug":"notebooks.stochastic-calculus","title":"Stochastic Calculus","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.bayesian-theory","title":"Bayesian Modelling","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.market-microstructure","title":"Market Microstructure","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.rfq-models","title":"Modelling RfQs in Dealer to Client Markets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.fair-price-estimation","title":"Fair Price Estimation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3102","MODE":"static"},"routes/$":{"config":{"version":3,"myst":"1.7.0","options":{"folders":true},"nav":[],"actions":[{"title":"Advanced Analytics and Algorithmic Trading","url":"https://www.datasciencealgotrading.com","internal":false,"static":false}],"projects":[{"bibliography":["/Users/javier/Documents/aaat/references.bib"],"exports":[],"title":"Advanced Analytics and Algorithmic Trading","authors":[{"nameParsed":{"literal":"Javier Sabio González","given":"Javier Sabio","family":"González"},"name":"Javier Sabio González","id":"contributors-myst-generated-uid-0"}],"github":"https://xaviweise.github.io/aaat/","toc":[{"file":"welcome.md"},{"children":[{"file":"markdown/releases.md"},{"file":"markdown/dedication.md"},{"file":"markdown/preface.md"},{"file":"markdown/symbollist.md"}],"title":"Introduction"},{"children":[{"file":"markdown/intro_financial_markets.md"},{"file":"markdown/intro_financial_instruments.md"},{"file":"markdown/market_microstructure.md"},{"file":"markdown/algorithmic_trading.md"}],"title":"Financial Markets Fundamentals"},{"children":[{"file":"markdown/intro_bayesian.md"},{"file":"markdown/intro_causal.md"},{"file":"markdown/stochastic_calculus.md"},{"file":"markdown/stochastic_optimal_control.md"},{"file":"markdown/data_driven_methods.md"},{"file":"markdown/generative_ai.md"}],"title":"Financial Modelling Fundamentals"},{"children":[{"file":"markdown/execution_fundamentals.md"},{"file":"markdown/lob_models.md"},{"file":"markdown/almgren_chriss.md"},{"file":"markdown/execution_tactics.md"}],"title":"Execution Algorithms"},{"children":[{"file":"markdown/market_making_fundamentals.md"},{"file":"markdown/fair_price_estimation.md"},{"file":"markdown/liquidity_modelling.md"},{"file":"markdown/rfq_models.md"},{"file":"markdown/avellaneda_stoikov.md"},{"file":"markdown/enriching_avellaneda.md"},{"file":"markdown/hedging.md"},{"file":"markdown/market_making_rl.md"}],"title":"Market Making Algorithms"},{"children":[{"file":"markdown/quant_investment_fundamentals.md"},{"file":"markdown/mean_reversion_strategies.md"},{"file":"markdown/trend_following.md"},{"file":"markdown/arbitrage.md"},{"file":"markdown/factor_investing.md"},{"file":"markdown/optimal_portfolios.md"}],"title":"Investment Algorithms"},{"children":[{"file":"markdown/glossary.md"},{"file":"markdown/references.md"}],"title":"Glossary and References"},{"children":[{"file":"notebooks/stochastic_calculus.ipynb"},{"file":"notebooks/bayesian_theory.ipynb"},{"file":"notebooks/market_microstructure.ipynb"},{"file":"notebooks/rfq_models.ipynb"},{"file":"notebooks/fair_price_estimation.ipynb"}],"title":"Notebooks"}],"thumbnail":"/build/cover-09caa9dd03fd74a2e96de11fa5332265.jpg","index":"index","pages":[{"level":1,"title":"Introduction"},{"slug":"markdown.releases","title":"Release Notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.dedication","title":"Dedication","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.preface","title":"Preface","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.symbollist","title":"Symbols","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Financial Markets Fundamentals"},{"slug":"markdown.intro-financial-markets","title":"Financial Markets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.intro-financial-instruments","title":"Mechanics of Financial Instruments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.market-microstructure","title":"Market microstructure","description":"","date":"","thumbnail":"/build/market_depth_clob-8d7158d59689e10c78a15c00090f3dc4.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.algorithmic-trading","title":"Algorithmic Trading","description":"","date":"","thumbnail":"/build/limit_vs_market-0a6d7ce61f57effed138b6bb69160517.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Financial Modelling Fundamentals"},{"slug":"markdown.intro-bayesian","title":"Bayesian Modelling","description":"","date":"","thumbnail":"/build/BernoulliUniformPrio-612a838836d4fde1c1b34df2b9eb9c9d.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.intro-causal","title":"Causal inference","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.stochastic-calculus","title":"Stochastic Calculus","description":"","date":"","thumbnail":"/build/num_inflation_target-584cfec49aaf388290dcb09ab4055202.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.stochastic-optimal-control","title":"Stochastic optimal control","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.data-driven-methods","title":"Data-driven methods","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.generative-ai","title":"Generative Artificial Intelligence","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Execution Algorithms"},{"slug":"markdown.execution-fundamentals","title":"Execution fundamentals","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.lob-models","title":"Modelling the Limit Order Book","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.almgren-chriss","title":"The Almgren - Chriss Framework","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.execution-tactics","title":"Execution tactics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Market Making Algorithms"},{"slug":"markdown.market-making-fundamentals","title":"Market Making fundamentals","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.fair-price-estimation","title":"Fair value estimation","description":"","date":"","thumbnail":"/build/kalman_correlated-8857bc936e112d039ba99093affb1fea.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.liquidity-modelling","title":"Liquidity modelling","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.rfq-models","title":"Modelling RfQs in Dealer to Client Markets","description":"","date":"","thumbnail":"/build/pgm_rfq-e1698d70d99c736157fd61e8c19c7918.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.avellaneda-stoikov","title":"The Avellaneda and Stoikov Framework","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.enriching-avellaneda","title":"Enriching the Avellaneda and Stoikov Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.hedging","title":"Hedging strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.market-making-rl","title":"Reinforcement Learning and Market Making","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Investment Algorithms"},{"slug":"markdown.quant-investment-fundamentals","title":"Quantitative investment fundamentals","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.mean-reversion-strategies","title":"Mean reversion strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.trend-following","title":"Trend following strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.arbitrage","title":"Arbitrage Strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.factor-investing","title":"Factor Investing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.optimal-portfolios","title":"Optimal portfolios","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Glossary and References"},{"slug":"markdown.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.references","title":"References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Notebooks"},{"slug":"notebooks.stochastic-calculus","title":"Stochastic Calculus","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.bayesian-theory","title":"Bayesian Modelling","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.market-microstructure","title":"Market Microstructure","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.rfq-models","title":"Modelling RfQs in Dealer to Client Markets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.fair-price-estimation","title":"Fair Price Estimation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Notebook","sha256":"e99a98a2d5b84d2a46205a9be49597f6be8c3365fc2e99942585e534a207ed9b","slug":"notebooks.market-microstructure","location":"/notebooks/market_microstructure.ipynb","dependencies":[],"frontmatter":{"title":"Market Microstructure","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"base","language":"python"},"authors":[{"nameParsed":{"literal":"Javier Sabio González","given":"Javier Sabio","family":"González"},"name":"Javier Sabio González","id":"contributors-myst-generated-uid-0"}],"github":"https://xaviweise.github.io/aaat/","numbering":{"title":{"offset":1}},"source_url":"https://xaviweise.github.io/aaat//blob/main/notebooks/market_microstructure.ipynb","edit_url":"https://xaviweise.github.io/aaat//edit/main/notebooks/market_microstructure.ipynb","exports":[{"format":"ipynb","filename":"market_microstructure.ipynb","url":"/build/market_microstructur-3ccb014fb1af0fe107dbae889b2488f7.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The Central Limit Order Book","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NTSesjFDKY"}],"identifier":"the-central-limit-order-book","label":"The Central Limit Order Book","html_id":"the-central-limit-order-book","implicit":true,"key":"xv68F8V7mc"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Visualization of the order book","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jQA2grHCJz"}],"identifier":"visualization-of-the-order-book","label":"Visualization of the order book","html_id":"visualization-of-the-order-book","implicit":true,"key":"OW2FOPVdqe"}],"key":"QBhnTYvcKk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\n\n# Define bid and ask prices\nbid_prices = np.array([94, 95, 96, 97, 98, 99])  # Bid price levels\nask_prices = np.array([101, 102, 103, 104, 105, 106])  # Ask price levels\n\n# Randomize volumes for bids and asks\nnp.random.seed(45)  # For reproducibility\nbid_volumes = np.random.randint(50, 400, size=len(bid_prices))  # Random volumes for bids\nask_volumes = np.random.randint(50, 400, size=len(ask_prices))  # Random volumes for asks\n\n# Empty volumes for levels close to the mid-price (bid at 99 and ask at 101)\nbid_volumes[5] = 0  # Bid close to mid (price 99)\nask_volumes[0] = 0  # Ask close to mid (price 101)\n\n# Calculate the best bid and ask prices and their volumes\n# Best bid: highest bid price with non-zero volume\nnonzero_bid_indices = np.where(bid_volumes \u003e 0)[0]\nif len(nonzero_bid_indices) \u003e 0:\n    best_bid_price = bid_prices[nonzero_bid_indices].max()\n    best_bid_index = np.where(bid_prices == best_bid_price)[0][0]\n    best_bid_volume = bid_volumes[best_bid_index]\nelse:\n    best_bid_price = None\n    best_bid_volume = 0\n\n# Best ask: lowest ask price with non-zero volume\nnonzero_ask_indices = np.where(ask_volumes \u003e 0)[0]\nif len(nonzero_ask_indices) \u003e 0:\n    best_ask_price = ask_prices[nonzero_ask_indices].min()\n    best_ask_index = np.where(ask_prices == best_ask_price)[0][0]\n    best_ask_volume = ask_volumes[best_ask_index]\nelse:\n    best_ask_price = None\n    best_ask_volume = 0\n\n# Calculate mid-price and spread\nif best_bid_price is not None and best_ask_price is not None:\n    mid_price = (best_bid_price + best_ask_price) / 2\n    spread = best_ask_price - best_bid_price\nelse:\n    mid_price = None\n    spread = None\n\n# Calculate imbalance between best bid and ask volumes\ntotal_volume = best_bid_volume + best_ask_volume\nif total_volume \u003e 0:\n    imbalance = (best_bid_volume - best_ask_volume) / total_volume\nelse:\n    imbalance = None\n\n# Create figure and axes\nfig, ax = plt.subplots(figsize=(10, 6))\n\n# Plot bid bars (leave a gap near the mid-price)\nax.bar(bid_prices, bid_volumes, color='green', align='center', label='Bid Orders')\n\n# Plot ask bars (leave a gap near the mid-price)\nax.bar(ask_prices, ask_volumes, color='red', align='center', label='Ask Orders')\n\n# Mid-price line\nif mid_price is not None:\n    ax.axvline(mid_price, color='black', linestyle='--', label=f'Mid Price')\nelse:\n    ax.axvline(100, color='black', linestyle='--', label='Mid Price')\n\n# Adding x-axis ticks for every integer price level from min to max price\nall_price_levels = np.arange(min(bid_prices.min(), ask_prices.min()), max(bid_prices.max(), ask_prices.max()) + 1)\nax.set_xticks(all_price_levels)\nax.set_xticklabels(all_price_levels)\n\n# Labels and title\nax.set_ylabel('Volume')\nax.set_xlabel('Price Levels')\nax.set_title('Central Limit Order Book (Market Depth)')\nax.legend()\n\n# Show the plot\nplt.show()\n\n# Print the calculated values\nprint(\"Calculated Market Metrics:\")\nif best_bid_price is not None:\n    print(f\"Best Bid Price: {best_bid_price}, Volume: {best_bid_volume}\")\nelse:\n    print(\"No bids available.\")\n\nif best_ask_price is not None:\n    print(f\"Best Ask Price: {best_ask_price}, Volume: {best_ask_volume}\")\nelse:\n    print(\"No asks available.\")\n\nif mid_price is not None and spread is not None:\n    print(f\"Mid-Price: {mid_price:.2f}\")\n    print(f\"Spread: {spread:.2f}\")\nelse:\n    print(\"Mid-Price and Spread are not available.\")\n\nif imbalance is not None:\n    print(f\"Imbalance between best bid and ask: {imbalance:.2f}\")\nelse:\n    print(\"Imbalance is not available due to zero total volume at best bid and ask.\")\n","key":"Mdnko4C1ZR"},{"type":"outputs","id":"IWxTIOTHePRBICEBkL1lZ","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b3c608131bbf816449255a1770f121c6","path":"/build/b3c608131bbf816449255a1770f121c6.png"},"text/plain":{"content":"\u003cFigure size 1000x600 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"KkVrK4tMwL"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Calculated Market Metrics:\nBest Bid Price: 98, Volume: 213\nBest Ask Price: 102, Volume: 65\nMid-Price: 100.00\nSpread: 4.00\nImbalance between best bid and ask: 0.53\n"},"children":[],"key":"jpmv4AR785"}],"key":"ImeDhwdtGw"}],"key":"QQNv1VVk8F"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Effect of a market order in the CLOB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pd9An2R0QF"}],"identifier":"effect-of-a-market-order-in-the-clob","label":"Effect of a market order in the CLOB","html_id":"effect-of-a-market-order-in-the-clob","implicit":true,"key":"oQDdKZGYVf"}],"key":"WHnzyKkXzv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\n\n# Define bid and ask prices\nbid_prices = np.array([94, 95, 96, 97, 98, 99])  # Bid price levels\nask_prices = np.array([101, 102, 103, 104, 105, 106])  # Ask price levels\n\n# Randomize volumes for bids and asks\nnp.random.seed(45)  # For reproducibility\nbid_volumes = np.random.randint(50, 400, size=len(bid_prices))  # Random volumes for bids\nask_volumes = np.random.randint(50, 400, size=len(ask_prices))  # Random volumes for asks\n\n# Empty volumes for levels close to the mid-price (bid at 99 and ask at 101)\nbid_volumes[5] = 0  # Bid close to mid\nask_volumes[0] = 0  # Ask close to mid\n\n# Arrays to track consumed volumes (for visualization)\nconsumed_bid_volumes = np.zeros(len(bid_volumes))\nconsumed_ask_volumes = np.zeros(len(ask_volumes))\n\nmid_price = 100  # Initial mid-price before market order execution\n\n# Simulate market order input\nmarket_order_size = 500  # For example, 500\nmarket_order_side = \"buy\"  # For example, 'buy'\n\n# Function to simulate the market order\ndef execute_market_order(order_size, order_side):\n    global bid_volumes, ask_volumes, consumed_bid_volumes, consumed_ask_volumes\n    executed_volume = 0\n    executed_value = 0\n\n    if order_side == 'buy':  # Market order to buy shares\n        remaining_size = order_size\n        for i in range(len(ask_prices)):\n            if ask_volumes[i] \u003e 0:\n                tradable_volume = min(ask_volumes[i], remaining_size)\n                executed_volume += tradable_volume\n                executed_value += tradable_volume * ask_prices[i]\n                consumed_ask_volumes[i] += tradable_volume  # Track consumed volume\n                ask_volumes[i] -= tradable_volume\n                remaining_size -= tradable_volume\n                if remaining_size \u003c= 0:\n                    break\n    elif order_side == 'sell':  # Market order to sell shares\n        remaining_size = order_size\n        for i in range(len(bid_prices)-1, -1, -1):  # Start from highest bid\n            if bid_volumes[i] \u003e 0:\n                tradable_volume = min(bid_volumes[i], remaining_size)\n                executed_volume += tradable_volume\n                executed_value += tradable_volume * bid_prices[i]\n                consumed_bid_volumes[i] += tradable_volume  # Track consumed volume\n                bid_volumes[i] -= tradable_volume\n                remaining_size -= tradable_volume\n                if remaining_size \u003c= 0:\n                    break\n\n    # Calculate the average execution price\n    execution_price = executed_value / executed_volume if executed_volume \u003e 0 else 0\n    return execution_price\n\n# Function to recalculate the mid-price based on the updated order book\ndef recalculate_mid_price():\n    global bid_prices, bid_volumes, ask_prices, ask_volumes\n    # Get the best bid price (highest bid price with non-zero volume)\n    if np.any(bid_volumes \u003e 0):\n        best_bid = np.max(bid_prices[bid_volumes \u003e 0])\n    else:\n        best_bid = np.nan  # No bids in the book\n\n    # Get the best ask price (lowest ask price with non-zero volume)\n    if np.any(ask_volumes \u003e 0):\n        best_ask = np.min(ask_prices[ask_volumes \u003e 0])\n    else:\n        best_ask = np.nan  # No asks in the book\n\n    # Recalculate mid-price\n    if not np.isnan(best_bid) and not np.isnan(best_ask):\n        new_mid_price = (best_bid + best_ask) / 2\n    elif not np.isnan(best_bid):\n        new_mid_price = best_bid  # Only bids are available\n    elif not np.isnan(best_ask):\n        new_mid_price = best_ask  # Only asks are available\n    else:\n        new_mid_price = np.nan  # No bids or asks in the book\n\n    return new_mid_price\n\n# Updated function to visualize the order book\ndef plot_order_book(order_side, mid_price):\n    fig, ax = plt.subplots(figsize=(10, 6))\n\n    # Plot remaining bid orders in green\n    ax.bar(bid_prices, bid_volumes, color='green', align='center', label='Remaining Bid Orders')\n\n    # Plot remaining ask orders in red\n    ax.bar(ask_prices, ask_volumes, color='red', align='center', label='Remaining Ask Orders')\n\n    # Plot consumed liquidity based on the order side\n    if order_side == 'buy':\n        # Plot consumed ask liquidity on top with a hatch pattern\n        if np.any(consumed_ask_volumes \u003e 0):\n            ax.bar(ask_prices, consumed_ask_volumes, bottom=ask_volumes, color='red', align='center',\n                   label='Consumed Ask Liquidity', hatch='\\\\\\\\', edgecolor='red', alpha=0.7)\n    elif order_side == 'sell':\n        # Plot consumed bid liquidity on top with a hatch pattern\n        if np.any(consumed_bid_volumes \u003e 0):\n            ax.bar(bid_prices, consumed_bid_volumes, bottom=bid_volumes, color='green', align='center',\n                   label='Consumed Bid Liquidity', hatch='//', edgecolor='green', alpha=0.7)\n\n    # Mid-price line\n    if not np.isnan(mid_price):\n        ax.axvline(mid_price, color='black', linestyle='--', label=f'Mid Price')\n    else:\n        ax.axvline(mid_price, color='black', linestyle='--', label='Mid Price Unavailable')\n\n    # Adding x-axis ticks for every integer price level from min to max price\n    all_price_levels = np.arange(min(bid_prices.min(), ask_prices.min()), max(bid_prices.max(), ask_prices.max()) + 1)\n    ax.set_xticks(all_price_levels)\n    ax.set_xticklabels(all_price_levels)\n\n    # Labels and title\n    ax.set_ylabel('Volume')\n    ax.set_xlabel('Price Levels')\n    ax.set_title('Effect of a Market Order in the CLOB')\n\n    # Custom legend to include only relevant labels\n    handles, labels = ax.get_legend_handles_labels()\n    by_label = dict(zip(labels, handles))\n\n    # Filter the legend labels based on the order side\n    if order_side == 'buy':\n        by_label.pop('Consumed Bid Liquidity', None)\n    elif order_side == 'sell':\n        by_label.pop('Consumed Ask Liquidity', None)\n\n    ax.legend(by_label.values(), by_label.keys())\n\n    plt.show()\n\n# Execute the market order and update the order book\nexecution_price = execute_market_order(market_order_size, market_order_side)\n\n# Recalculate the mid-price based on the updated order book\nnew_mid_price = recalculate_mid_price()\n\n# Plot the updated order book with the new mid-price\nplot_order_book(market_order_side, new_mid_price)\n\n# Output the execution price and the new mid-price\nprint(f\"The average execution price for the market order is: {execution_price:.2f}\")\nif not np.isnan(new_mid_price):\n    print(f\"The new mid-price after the market order execution is: {new_mid_price:.2f}\")\nelse:\n    print(\"The mid-price is unavailable due to no bids or asks in the book.\")\n","key":"Kaoyc6gD8w"},{"type":"outputs","id":"UZosG2jm3LR3gxiYpJ20S","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"aa56161046499d81cae58ec2da0f4e3f","path":"/build/aa56161046499d81cae58ec2da0f4e3f.png"},"text/plain":{"content":"\u003cFigure size 1000x600 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"d9i7zmJ3jw"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"The average execution price for the market order is: 103.51\nThe new mid-price after the market order execution is: 101.00\n"},"children":[],"key":"AvYk59y8Zy"}],"key":"l7WUAgOu8p"}],"key":"Z7X9zCNiD5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Effect of a limit order in the CLOB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UJJhbuuguQ"}],"identifier":"effect-of-a-limit-order-in-the-clob","label":"Effect of a limit order in the CLOB","html_id":"effect-of-a-limit-order-in-the-clob","implicit":true,"key":"PLZG6a9s8I"}],"key":"fSuqGcsPVt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nimport numpy as np\n\n# Define bid and ask prices\nbid_prices = np.array([94, 95, 96, 97, 98, 99])  # Bid price levels\nask_prices = np.array([101, 102, 103, 104, 105, 106])  # Ask price levels\n\n# Randomize volumes for bids and asks\nnp.random.seed(45)  # For reproducibility\nbid_volumes = np.random.randint(50, 400, size=len(bid_prices))  # Random volumes for bids\nask_volumes = np.random.randint(50, 400, size=len(ask_prices))  # Random volumes for asks\n\n# Empty volumes for levels close to the mid-price (bid at 99 and ask at 101)\nbid_volumes[5] = 0  # Bid close to mid\nask_volumes[0] = 0  # Ask close to mid\n\n# Arrays to track consumed volumes and new limit orders for visualization\nconsumed_bid_volumes = np.zeros(len(bid_volumes))\nconsumed_ask_volumes = np.zeros(len(ask_volumes))\nnew_bid_volumes = np.zeros(len(bid_volumes))\nnew_ask_volumes = np.zeros(len(ask_volumes))\n\nmid_price = 100  # Initial mid-price before limit order execution\n\n# Function to simulate an aggressive limit order\ndef execute_limit_order(order_price, order_volume, order_side):\n    global bid_volumes, ask_volumes, consumed_bid_volumes, consumed_ask_volumes, new_bid_volumes, new_ask_volumes\n\n    executed_volume = 0\n    executed_value = 0\n    remaining_volume = order_volume\n\n    if order_side == 'buy':\n        best_ask = min(ask_prices[ask_volumes \u003e 0]) if np.any(ask_volumes \u003e 0) else np.inf\n        if order_price \u003c best_ask:\n            # The buy limit order remains unexecuted and gets added to the book below existing orders\n            insert_order_into_book(order_price, remaining_volume, 'buy', priority='low')\n            return 0, remaining_volume  # No execution, entire order sits in the book\n        else:\n            # The buy limit order consumes liquidity like a market order up to the limit price\n            for i in range(len(ask_prices)):\n                if ask_prices[i] \u003c= order_price and ask_volumes[i] \u003e 0:\n                    if ask_volumes[i] \u003e= remaining_volume:\n                        executed_volume += remaining_volume\n                        executed_value += remaining_volume * ask_prices[i]\n                        consumed_ask_volumes[i] += remaining_volume  # Track consumed volume\n                        ask_volumes[i] -= remaining_volume\n                        remaining_volume = 0\n                        break\n                    else:\n                        executed_volume += ask_volumes[i]\n                        executed_value += ask_volumes[i] * ask_prices[i]\n                        consumed_ask_volumes[i] += ask_volumes[i]  # Track consumed volume\n                        remaining_volume -= ask_volumes[i]\n                        ask_volumes[i] = 0\n            # Any remaining volume sits in the book at the limit price\n            if remaining_volume \u003e 0:\n                insert_order_into_book(order_price, remaining_volume, 'buy', priority='low')\n\n    elif order_side == 'sell':\n        best_bid = max(bid_prices[bid_volumes \u003e 0]) if np.any(bid_volumes \u003e 0) else -np.inf\n        if order_price \u003e best_bid:\n            # The sell limit order remains unexecuted and gets added to the book above existing orders\n            insert_order_into_book(order_price, remaining_volume, 'sell', priority='low')\n            return 0, remaining_volume  # No execution, entire order sits in the book\n        else:\n            # The sell limit order consumes liquidity like a market order up to the limit price\n            for i in range(len(bid_prices)-1, -1, -1):  # Start from highest bid\n                if bid_prices[i] \u003e= order_price and bid_volumes[i] \u003e 0:\n                    if bid_volumes[i] \u003e= remaining_volume:\n                        executed_volume += remaining_volume\n                        executed_value += remaining_volume * bid_prices[i]\n                        consumed_bid_volumes[i] += remaining_volume  # Track consumed volume\n                        bid_volumes[i] -= remaining_volume\n                        remaining_volume = 0\n                        break\n                    else:\n                        executed_volume += bid_volumes[i]\n                        executed_value += bid_volumes[i] * bid_prices[i]\n                        consumed_bid_volumes[i] += bid_volumes[i]  # Track consumed volume\n                        remaining_volume -= bid_volumes[i]\n                        bid_volumes[i] = 0\n            # Any remaining volume sits in the book at the limit price\n            if remaining_volume \u003e 0:\n                insert_order_into_book(order_price, remaining_volume, 'sell', priority='low')\n\n    # Calculate the average execution price\n    execution_price = executed_value / executed_volume if executed_volume \u003e 0 else 0\n    return execution_price, remaining_volume\n\n# Function to insert the remaining limit order into the order book\ndef insert_order_into_book(order_price, remaining_volume, order_side, priority):\n    global bid_prices, ask_prices, bid_volumes, ask_volumes, new_bid_volumes, new_ask_volumes, consumed_bid_volumes, consumed_ask_volumes\n\n    if order_side == 'buy':  # Remaining buy order stays as a bid\n        # Check if the price level exists\n        if order_price in bid_prices:\n            index = np.where(bid_prices == order_price)[0][0]\n            if priority == 'low':\n                new_bid_volumes[index] += remaining_volume  # Lower priority new limit order\n            else:\n                bid_volumes[index] += remaining_volume  # Higher priority remaining volume\n        else:\n            # Insert a new price level\n            bid_prices = np.append(bid_prices, order_price)\n            bid_volumes = np.append(bid_volumes, 0 if priority == 'low' else remaining_volume)\n            new_bid_volumes = np.append(new_bid_volumes, remaining_volume if priority == 'low' else 0)\n            consumed_bid_volumes = np.append(consumed_bid_volumes, 0)\n            # Sort by price\n            sort_indices = np.argsort(bid_prices)\n            bid_prices = bid_prices[sort_indices]\n            bid_volumes = bid_volumes[sort_indices]\n            new_bid_volumes = new_bid_volumes[sort_indices]\n            consumed_bid_volumes = consumed_bid_volumes[sort_indices]\n\n    elif order_side == 'sell':  # Remaining sell order stays as an ask\n        # Check if the price level exists\n        if order_price in ask_prices:\n            index = np.where(ask_prices == order_price)[0][0]\n            if priority == 'low':\n                new_ask_volumes[index] += remaining_volume  # Lower priority new limit order\n            else:\n                ask_volumes[index] += remaining_volume  # Higher priority remaining volume\n        else:\n            # Insert a new price level\n            ask_prices = np.append(ask_prices, order_price)\n            ask_volumes = np.append(ask_volumes, 0 if priority == 'low' else remaining_volume)\n            new_ask_volumes = np.append(new_ask_volumes, remaining_volume if priority == 'low' else 0)\n            consumed_ask_volumes = np.append(consumed_ask_volumes, 0)\n            # Sort by price\n            sort_indices = np.argsort(ask_prices)\n            ask_prices = ask_prices[sort_indices]\n            ask_volumes = ask_volumes[sort_indices]\n            new_ask_volumes = new_ask_volumes[sort_indices]\n            consumed_ask_volumes = consumed_ask_volumes[sort_indices]\n\n# Function to recalculate the mid-price based on the updated order book\ndef recalculate_mid_price():\n    global bid_prices, bid_volumes, ask_prices, ask_volumes, new_bid_volumes, new_ask_volumes\n    # Calculate total bid volumes at each price level\n    total_bid_volumes = bid_volumes + new_bid_volumes\n    # Get the best bid price (highest bid price with non-zero volume)\n    if np.any(total_bid_volumes \u003e 0):\n        best_bid = np.max(bid_prices[total_bid_volumes \u003e 0])\n    else:\n        best_bid = np.nan  # No bids in the book\n\n    # Calculate total ask volumes at each price level\n    total_ask_volumes = ask_volumes + new_ask_volumes\n    # Get the best ask price (lowest ask price with non-zero volume)\n    if np.any(total_ask_volumes \u003e 0):\n        best_ask = np.min(ask_prices[total_ask_volumes \u003e 0])\n    else:\n        best_ask = np.nan  # No asks in the book\n\n    # Recalculate mid-price\n    if not np.isnan(best_bid) and not np.isnan(best_ask):\n        new_mid_price = (best_bid + best_ask) / 2\n    elif not np.isnan(best_bid):\n        new_mid_price = best_bid  # Only bids are available\n    elif not np.isnan(best_ask):\n        new_mid_price = best_ask  # Only asks are available\n    else:\n        new_mid_price = np.nan  # No bids or asks in the book\n\n    return new_mid_price\n\n# Updated function to visualize the order book\ndef plot_order_book(order_side, mid_price):\n    fig, ax = plt.subplots(figsize=(10, 6))\n\n    # For bids\n    # Total volumes for stacking\n    bid_total_volumes = new_bid_volumes + bid_volumes + consumed_bid_volumes\n\n    # Plot new bid limit orders at the bottom\n    ax.bar(bid_prices, new_bid_volumes, color='darkgreen', align='center',\n           label='New Bid Limit Orders')\n\n    # Plot existing bid orders on top of new limit orders\n    bid_existing_bottom = new_bid_volumes\n    ax.bar(bid_prices, bid_volumes, bottom=bid_existing_bottom, color='green', align='center',\n           label='Remaining Bid Orders')\n\n    # Plot consumed bid liquidity on top of existing orders\n    bid_consumed_bottom = bid_existing_bottom + bid_volumes\n    if np.any(consumed_bid_volumes \u003e 0):\n        ax.bar(bid_prices, consumed_bid_volumes, bottom=bid_consumed_bottom, color='green', align='center',\n               label='Consumed Liquidity', hatch='//', edgecolor='green', alpha=0.7)\n\n    # For asks\n    # Total volumes for stacking\n    ask_total_volumes = new_ask_volumes + ask_volumes + consumed_ask_volumes\n\n    # Plot new ask limit orders at the bottom\n    ax.bar(ask_prices, new_ask_volumes, color='darkred', align='center',\n           label='New Ask Limit Orders')\n\n    # Plot existing ask orders on top of new limit orders\n    ask_existing_bottom = new_ask_volumes\n    ax.bar(ask_prices, ask_volumes, bottom=ask_existing_bottom, color='red', align='center',\n           label='Remaining Ask Orders')\n\n    # Plot consumed ask liquidity on top of existing orders\n    ask_consumed_bottom = ask_existing_bottom + ask_volumes\n    if np.any(consumed_ask_volumes \u003e 0):\n        ax.bar(ask_prices, consumed_ask_volumes, bottom=ask_consumed_bottom, color='red', align='center',\n               label='Consumed Liquidity', hatch='\\\\\\\\', edgecolor='red', alpha=0.7)\n\n    # Mid-price line\n    if not np.isnan(mid_price):\n        ax.axvline(mid_price, color='black', linestyle='--', label=f'Mid Price')\n    else:\n        ax.axvline(mid_price, color='black', linestyle='--', label='Mid Price Unavailable')\n\n    # Adding x-axis ticks\n    all_price_levels = np.arange(min(bid_prices.min(), ask_prices.min()), max(bid_prices.max(), ask_prices.max()) + 1)\n    ax.set_xticks(all_price_levels)\n    ax.set_xticklabels(all_price_levels)\n\n    # Labels and title\n    ax.set_ylabel('Volume')\n    ax.set_xlabel('Price Levels')\n    ax.set_title('Effect of a limit order in the CLOB')\n\n    # Custom legend\n    handles, labels = ax.get_legend_handles_labels()\n    by_label = dict(zip(labels, handles))\n    ax.legend(by_label.values(), by_label.keys())\n\n    plt.show()\n\n# Example of a buy limit order at price 102 for 700 shares\nlimit_order_price = 98\nlimit_order_volume = 500\nlimit_order_side = 'buy'\n\n# Execute the limit order\nexecution_price, remaining_volume = execute_limit_order(limit_order_price, limit_order_volume, limit_order_side)\n\n# Recalculate the mid-price based on the updated order book\nnew_mid_price = recalculate_mid_price()\n\n# Plot the updated order book with the new mid-price\nplot_order_book(limit_order_side, new_mid_price)\n\n# Output the execution price and remaining order details\nprint(f\"The average execution price for the limit order is: {execution_price:.2f}\")\nif remaining_volume \u003e 0:\n    print(f\"Remaining order of {remaining_volume} shares sits in the book at the limit price of {limit_order_price}.\")\nif not np.isnan(new_mid_price):\n    print(f\"The new mid-price after the limit order execution is: {new_mid_price:.2f}\")\nelse:\n    print(\"The mid-price is unavailable due to no bids or asks in the book.\")\n","key":"uEcpvXCXUx"},{"type":"outputs","id":"OMJhGqBioJAC682T-k69h","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"35c62b7c186dc7d9deaf54963ae515ee","path":"/build/35c62b7c186dc7d9deaf54963ae515ee.png"},"text/plain":{"content":"\u003cFigure size 1000x600 with 1 Axes\u003e","content_type":"text/plain"}}},"children":[],"key":"VsL50Ofwt6"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"The average execution price for the limit order is: 0.00\nRemaining order of 500 shares sits in the book at the limit price of 98.\nThe new mid-price after the limit order execution is: 100.00\n"},"children":[],"key":"U61ZEraZh5"}],"key":"DczfwGLvZj"}],"key":"xWYYlIV16n"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The RfQ process in MD2C platforms","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tAxcNYLKjl"}],"identifier":"the-rfq-process-in-md2c-platforms","label":"The RfQ process in MD2C platforms","html_id":"the-rfq-process-in-md2c-platforms","implicit":true,"key":"BzsEPuhSJv"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Visualization of RfQ process","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZlXS7kjPd2"}],"identifier":"visualization-of-rfq-process","label":"Visualization of RfQ process","html_id":"visualization-of-rfq-process","implicit":true,"key":"z9zeRPZpV8"}],"key":"XHdrIHcUfd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from graphviz import Digraph\n\n# Create a new directed graph\ndot = Digraph(comment='RfQ Protocol')\n\n# Graph-level attributes for font\ndot.attr(fontname='Helvetica', fontsize='12')\n\n# Add nodes with custom fonts\ndot.node('Client', 'Client', shape='ellipse', style='filled', color='lightblue', fontname='Helvetica', fontsize='12')\ndot.node('Platform', 'Platform', shape='box', style='filled', color='lightgrey', fontname='Helvetica', fontsize='12')\n\n# Add dealers with custom fonts\nfor i in range(1, 5):  # Adjust the number of dealers as needed\n    dot.node(f'Dealer{i}', f'Dealer {i}', shape='ellipse', style='filled', color='lightcoral', fontname='Helvetica-Italic', fontsize='12')\n\n# Add edges with custom fonts\ndot.edge('Client', 'Platform', label='RfQ', fontname='Courier', fontsize='10', fontcolor='darkblue')\nfor i in range(1, 5):\n    dot.edge('Platform', f'Dealer{i}', label=f'RfQ', fontname='Courier', fontsize='10', fontcolor='darkblue')\n    dot.edge(f'Dealer{i}', 'Platform', label=f'Quote{i}', fontname='Courier', fontsize='10', fontcolor='darkred')\ndot.edge('Platform', 'Client', label='Quotes', fontname='Courier', fontsize='10', fontcolor='darkred')\n\n# Render and display the graph\n# dot.render(\"/Users/javier/Documents/aaat/markdown/rfq\", format='png', cleanup=True)\ndot","key":"ZBc54eUqnE"},{"type":"outputs","id":"Mgwz7arTdpFPlbuIc8NkG","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":45,"metadata":{},"data":{"image/svg+xml":{"content":"\u003c?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?\u003e\n\u003c!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"\u003e\n\u003c!-- Generated by graphviz version 2.50.0 (0)\n --\u003e\n\u003c!-- Pages: 1 --\u003e\n\u003csvg width=\"387pt\" height=\"210pt\"\n viewBox=\"0.00 0.00 387.33 210.00\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"\u003e\n\u003cg id=\"graph0\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 206)\"\u003e\n\u003cpolygon fill=\"white\" stroke=\"transparent\" points=\"-4,4 -4,-206 383.33,-206 383.33,4 -4,4\"/\u003e\n\u003c!-- Client --\u003e\n\u003cg id=\"node1\" class=\"node\"\u003e\n\u003ctitle\u003eClient\u003c/title\u003e\n\u003cellipse fill=\"lightblue\" stroke=\"lightblue\" cx=\"192.17\" cy=\"-184\" rx=\"29.6\" ry=\"18\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"192.17\" y=\"-180.9\" font-family=\"Helvetica,sans-Serif\" font-size=\"12.00\"\u003eClient\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Platform --\u003e\n\u003cg id=\"node2\" class=\"node\"\u003e\n\u003ctitle\u003ePlatform\u003c/title\u003e\n\u003cpolygon fill=\"lightgrey\" stroke=\"lightgrey\" points=\"222.67,-119 161.67,-119 161.67,-83 222.67,-83 222.67,-119\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"192.17\" y=\"-97.9\" font-family=\"Helvetica,sans-Serif\" font-size=\"12.00\"\u003ePlatform\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Client\u0026#45;\u0026gt;Platform --\u003e\n\u003cg id=\"edge1\" class=\"edge\"\u003e\n\u003ctitle\u003eClient\u0026#45;\u0026gt;Platform\u003c/title\u003e\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M180.73,-167.04C177.27,-161.31 173.93,-154.63 172.17,-148 170.44,-141.48 171.58,-134.7 174.02,-128.41\"/\u003e\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"177.37,-129.54 178.7,-119.03 171.1,-126.42 177.37,-129.54\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"181.67\" y=\"-140\" font-family=\"Courier,monospace\" font-size=\"10.00\" fill=\"darkblue\"\u003eRfQ\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Platform\u0026#45;\u0026gt;Client --\u003e\n\u003cg id=\"edge10\" class=\"edge\"\u003e\n\u003ctitle\u003ePlatform\u0026#45;\u0026gt;Client\u003c/title\u003e\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M192.17,-119.15C192.17,-129.78 192.17,-143.66 192.17,-155.77\"/\u003e\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"188.67,-155.82 192.17,-165.82 195.67,-155.82 188.67,-155.82\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"210.67\" y=\"-140\" font-family=\"Courier,monospace\" font-size=\"10.00\" fill=\"darkred\"\u003eQuotes\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Dealer1 --\u003e\n\u003cg id=\"node3\" class=\"node\"\u003e\n\u003ctitle\u003eDealer1\u003c/title\u003e\n\u003cellipse fill=\"lightcoral\" stroke=\"lightcoral\" cx=\"38.17\" cy=\"-18\" rx=\"38.33\" ry=\"18\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"38.17\" y=\"-14.9\" font-family=\"Helvetica-Italic\" font-size=\"12.00\"\u003eDealer 1\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Platform\u0026#45;\u0026gt;Dealer1 --\u003e\n\u003cg id=\"edge2\" class=\"edge\"\u003e\n\u003ctitle\u003ePlatform\u0026#45;\u0026gt;Dealer1\u003c/title\u003e\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M161.58,-98.33C116.81,-95.17 36.82,-86.58 19.17,-65 14.17,-58.89 15.16,-51.27 18.5,-44.01\"/\u003e\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"21.67,-45.54 23.72,-35.14 15.63,-41.99 21.67,-45.54\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"28.67\" y=\"-57\" font-family=\"Courier,monospace\" font-size=\"10.00\" fill=\"darkblue\"\u003eRfQ\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Dealer2 --\u003e\n\u003cg id=\"node4\" class=\"node\"\u003e\n\u003ctitle\u003eDealer2\u003c/title\u003e\n\u003cellipse fill=\"lightcoral\" stroke=\"lightcoral\" cx=\"144.17\" cy=\"-18\" rx=\"38.33\" ry=\"18\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"144.17\" y=\"-14.9\" font-family=\"Helvetica-Italic\" font-size=\"12.00\"\u003eDealer 2\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Platform\u0026#45;\u0026gt;Dealer2 --\u003e\n\u003cg id=\"edge4\" class=\"edge\"\u003e\n\u003ctitle\u003ePlatform\u0026#45;\u0026gt;Dealer2\u003c/title\u003e\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M161.45,-92.97C146.56,-87.85 130.02,-79.24 121.17,-65 116.92,-58.18 118.51,-50.47 122.34,-43.33\"/\u003e\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"125.46,-44.97 128.14,-34.72 119.65,-41.06 125.46,-44.97\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"130.67\" y=\"-57\" font-family=\"Courier,monospace\" font-size=\"10.00\" fill=\"darkblue\"\u003eRfQ\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Dealer3 --\u003e\n\u003cg id=\"node5\" class=\"node\"\u003e\n\u003ctitle\u003eDealer3\u003c/title\u003e\n\u003cellipse fill=\"lightcoral\" stroke=\"lightcoral\" cx=\"244.17\" cy=\"-18\" rx=\"38.33\" ry=\"18\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"244.17\" y=\"-14.9\" font-family=\"Helvetica-Italic\" font-size=\"12.00\"\u003eDealer 3\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Platform\u0026#45;\u0026gt;Dealer3 --\u003e\n\u003cg id=\"edge6\" class=\"edge\"\u003e\n\u003ctitle\u003ePlatform\u0026#45;\u0026gt;Dealer3\u003c/title\u003e\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M203.19,-82.82C210.44,-71.54 220.04,-56.59 228.12,-43.99\"/\u003e\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"231.23,-45.63 233.69,-35.32 225.34,-41.85 231.23,-45.63\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"230.67\" y=\"-57\" font-family=\"Courier,monospace\" font-size=\"10.00\" fill=\"darkblue\"\u003eRfQ\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Dealer4 --\u003e\n\u003cg id=\"node6\" class=\"node\"\u003e\n\u003ctitle\u003eDealer4\u003c/title\u003e\n\u003cellipse fill=\"lightcoral\" stroke=\"lightcoral\" cx=\"341.17\" cy=\"-18\" rx=\"38.33\" ry=\"18\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"341.17\" y=\"-14.9\" font-family=\"Helvetica-Italic\" font-size=\"12.00\"\u003eDealer 4\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Platform\u0026#45;\u0026gt;Dealer4 --\u003e\n\u003cg id=\"edge8\" class=\"edge\"\u003e\n\u003ctitle\u003ePlatform\u0026#45;\u0026gt;Dealer4\u003c/title\u003e\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M222.98,-91.45C241.92,-85.5 266.29,-76.55 286.17,-65 297.32,-58.52 308.46,-49.74 317.76,-41.6\"/\u003e\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"320.35,-43.98 325.42,-34.67 315.66,-38.78 320.35,-43.98\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"311.67\" y=\"-57\" font-family=\"Courier,monospace\" font-size=\"10.00\" fill=\"darkblue\"\u003eRfQ\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Dealer1\u0026#45;\u0026gt;Platform --\u003e\n\u003cg id=\"edge3\" class=\"edge\"\u003e\n\u003ctitle\u003eDealer1\u0026#45;\u0026gt;Platform\u003c/title\u003e\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M48.99,-35.56C56.19,-45.39 66.45,-57.39 78.17,-65 100.29,-79.39 128.65,-88.12 151.55,-93.27\"/\u003e\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"151.14,-96.76 161.64,-95.39 152.57,-89.91 151.14,-96.76\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"96.67\" y=\"-57\" font-family=\"Courier,monospace\" font-size=\"10.00\" fill=\"darkred\"\u003eQuote1\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Dealer2\u0026#45;\u0026gt;Platform --\u003e\n\u003cg id=\"edge5\" class=\"edge\"\u003e\n\u003ctitle\u003eDealer2\u0026#45;\u0026gt;Platform\u003c/title\u003e\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M149.87,-36.19C153.16,-45.1 157.73,-55.97 163.17,-65 165.21,-68.4 167.58,-71.82 170.05,-75.11\"/\u003e\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"167.35,-77.34 176.32,-82.97 172.82,-72.97 167.35,-77.34\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"181.67\" y=\"-57\" font-family=\"Courier,monospace\" font-size=\"10.00\" fill=\"darkred\"\u003eQuote2\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Dealer3\u0026#45;\u0026gt;Platform --\u003e\n\u003cg id=\"edge7\" class=\"edge\"\u003e\n\u003ctitle\u003eDealer3\u0026#45;\u0026gt;Platform\u003c/title\u003e\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M246.92,-36.15C247.55,-45.25 246.93,-56.31 242.17,-65 239.29,-70.24 235.26,-74.87 230.72,-78.9\"/\u003e\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"228.46,-76.22 222.71,-85.13 232.75,-81.75 228.46,-76.22\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"263.67\" y=\"-57\" font-family=\"Courier,monospace\" font-size=\"10.00\" fill=\"darkred\"\u003eQuote3\u003c/text\u003e\n\u003c/g\u003e\n\u003c!-- Dealer4\u0026#45;\u0026gt;Platform --\u003e\n\u003cg id=\"edge9\" class=\"edge\"\u003e\n\u003ctitle\u003eDealer4\u0026#45;\u0026gt;Platform\u003c/title\u003e\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M339.22,-36.04C337.23,-45.79 333.23,-57.53 325.17,-65 300.27,-88.04 262.05,-96.28 232.96,-99.06\"/\u003e\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"232.4,-95.6 222.7,-99.86 232.94,-102.57 232.4,-95.6\"/\u003e\n\u003ctext text-anchor=\"middle\" x=\"350.67\" y=\"-57\" font-family=\"Courier,monospace\" font-size=\"10.00\" fill=\"darkred\"\u003eQuote4\u003c/text\u003e\n\u003c/g\u003e\n\u003c/g\u003e\n\u003c/svg\u003e\n","content_type":"image/svg+xml"},"text/plain":{"content":"\u003cgraphviz.graphs.Digraph at 0x1137165e0\u003e","content_type":"text/plain"}}},"children":[],"key":"lksDwHjVEg"}],"key":"iA66GIdgD8"}],"key":"IUlsbn4cL2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"qgiTCeQxXx"},{"type":"outputs","id":"2fxPxkhBaPKkNnAzjRbeb","children":[],"key":"FFFoefsusF"}],"key":"jBd2Ko8kG6"}],"key":"ECMrRIXZW2"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Bayesian Modelling","url":"/notebooks/bayesian-theory","group":"Notebooks"},"next":{"title":"Modelling RfQs in Dealer to Client Markets","url":"/notebooks/rfq-models","group":"Notebooks"}}},"domain":"http://localhost:3002"},"project":{"bibliography":["/Users/javier/Documents/aaat/references.bib"],"exports":[],"title":"Advanced Analytics and Algorithmic Trading","authors":[{"nameParsed":{"literal":"Javier Sabio González","given":"Javier Sabio","family":"González"},"name":"Javier Sabio González","id":"contributors-myst-generated-uid-0"}],"github":"https://xaviweise.github.io/aaat/","toc":[{"file":"welcome.md"},{"children":[{"file":"markdown/releases.md"},{"file":"markdown/dedication.md"},{"file":"markdown/preface.md"},{"file":"markdown/symbollist.md"}],"title":"Introduction"},{"children":[{"file":"markdown/intro_financial_markets.md"},{"file":"markdown/intro_financial_instruments.md"},{"file":"markdown/market_microstructure.md"},{"file":"markdown/algorithmic_trading.md"}],"title":"Financial Markets Fundamentals"},{"children":[{"file":"markdown/intro_bayesian.md"},{"file":"markdown/intro_causal.md"},{"file":"markdown/stochastic_calculus.md"},{"file":"markdown/stochastic_optimal_control.md"},{"file":"markdown/data_driven_methods.md"},{"file":"markdown/generative_ai.md"}],"title":"Financial Modelling Fundamentals"},{"children":[{"file":"markdown/execution_fundamentals.md"},{"file":"markdown/lob_models.md"},{"file":"markdown/almgren_chriss.md"},{"file":"markdown/execution_tactics.md"}],"title":"Execution Algorithms"},{"children":[{"file":"markdown/market_making_fundamentals.md"},{"file":"markdown/fair_price_estimation.md"},{"file":"markdown/liquidity_modelling.md"},{"file":"markdown/rfq_models.md"},{"file":"markdown/avellaneda_stoikov.md"},{"file":"markdown/enriching_avellaneda.md"},{"file":"markdown/hedging.md"},{"file":"markdown/market_making_rl.md"}],"title":"Market Making Algorithms"},{"children":[{"file":"markdown/quant_investment_fundamentals.md"},{"file":"markdown/mean_reversion_strategies.md"},{"file":"markdown/trend_following.md"},{"file":"markdown/arbitrage.md"},{"file":"markdown/factor_investing.md"},{"file":"markdown/optimal_portfolios.md"}],"title":"Investment Algorithms"},{"children":[{"file":"markdown/glossary.md"},{"file":"markdown/references.md"}],"title":"Glossary and References"},{"children":[{"file":"notebooks/stochastic_calculus.ipynb"},{"file":"notebooks/bayesian_theory.ipynb"},{"file":"notebooks/market_microstructure.ipynb"},{"file":"notebooks/rfq_models.ipynb"},{"file":"notebooks/fair_price_estimation.ipynb"}],"title":"Notebooks"}],"thumbnail":"/build/cover-09caa9dd03fd74a2e96de11fa5332265.jpg","index":"index","pages":[{"level":1,"title":"Introduction"},{"slug":"markdown.releases","title":"Release Notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.dedication","title":"Dedication","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.preface","title":"Preface","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.symbollist","title":"Symbols","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Financial Markets Fundamentals"},{"slug":"markdown.intro-financial-markets","title":"Financial Markets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.intro-financial-instruments","title":"Mechanics of Financial Instruments","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.market-microstructure","title":"Market microstructure","description":"","date":"","thumbnail":"/build/market_depth_clob-8d7158d59689e10c78a15c00090f3dc4.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.algorithmic-trading","title":"Algorithmic Trading","description":"","date":"","thumbnail":"/build/limit_vs_market-0a6d7ce61f57effed138b6bb69160517.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Financial Modelling Fundamentals"},{"slug":"markdown.intro-bayesian","title":"Bayesian Modelling","description":"","date":"","thumbnail":"/build/BernoulliUniformPrio-612a838836d4fde1c1b34df2b9eb9c9d.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.intro-causal","title":"Causal inference","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.stochastic-calculus","title":"Stochastic Calculus","description":"","date":"","thumbnail":"/build/num_inflation_target-584cfec49aaf388290dcb09ab4055202.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.stochastic-optimal-control","title":"Stochastic optimal control","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.data-driven-methods","title":"Data-driven methods","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.generative-ai","title":"Generative Artificial Intelligence","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Execution Algorithms"},{"slug":"markdown.execution-fundamentals","title":"Execution fundamentals","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.lob-models","title":"Modelling the Limit Order Book","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.almgren-chriss","title":"The Almgren - Chriss Framework","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.execution-tactics","title":"Execution tactics","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Market Making Algorithms"},{"slug":"markdown.market-making-fundamentals","title":"Market Making fundamentals","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.fair-price-estimation","title":"Fair value estimation","description":"","date":"","thumbnail":"/build/kalman_correlated-8857bc936e112d039ba99093affb1fea.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.liquidity-modelling","title":"Liquidity modelling","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.rfq-models","title":"Modelling RfQs in Dealer to Client Markets","description":"","date":"","thumbnail":"/build/pgm_rfq-e1698d70d99c736157fd61e8c19c7918.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.avellaneda-stoikov","title":"The Avellaneda and Stoikov Framework","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.enriching-avellaneda","title":"Enriching the Avellaneda and Stoikov Model","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.hedging","title":"Hedging strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.market-making-rl","title":"Reinforcement Learning and Market Making","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Investment Algorithms"},{"slug":"markdown.quant-investment-fundamentals","title":"Quantitative investment fundamentals","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.mean-reversion-strategies","title":"Mean reversion strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.trend-following","title":"Trend following strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.arbitrage","title":"Arbitrage Strategies","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.factor-investing","title":"Factor Investing","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.optimal-portfolios","title":"Optimal portfolios","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Glossary and References"},{"slug":"markdown.glossary","title":"Glossary","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"markdown.references","title":"References","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Notebooks"},{"slug":"notebooks.stochastic-calculus","title":"Stochastic Calculus","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.bayesian-theory","title":"Bayesian Modelling","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.market-microstructure","title":"Market Microstructure","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.rfq-models","title":"Modelling RfQs in Dealer to Client Markets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.fair-price-estimation","title":"Fair Price Estimation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/build/manifest-86A905A4.js";
import * as route0 from "/build/root-CXYA7X5D.js";
import * as route1 from "/build/routes/$-JRBPULBO.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/build/entry.client-PCJPW7TK.js");</script></body></html>